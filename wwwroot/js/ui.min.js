/* init */

$(document).ready(function () {
    updateColorPalletPreview();
    updateCanvasSize();
    removeTransitionPreload();
});

/* preloader */

function removeTransitionPreload() {
    $("body").removeClass("preload");
}

/* enable bootstrap popover */

$(function () {
    $('[data-toggle="popover"]').popover()
})

/* update canvas */

$(window).resize(function () {
    updateCanvasSize();
});

function updateCanvasSize() {
    setTimeout(function () {
        $('#canvasWrapper>canvas').attr('height', $('#canvasWrapper>canvas').height());
        $('#canvasWrapper>canvas').attr('width', $('#canvasWrapper>canvas').width());
        redraw(drawingHistory);
    }, 10);
};

/* image overlay */

function addImageOverlay() {
    $('.overlay-img').attr('src', $('#imageOverlayLink').val());
}

function removeImageOverlay() {
    $('.overlay-img').attr('src', '');
}

/* toolbar ttem active handler */

$('.toolbar-item').click(function () {
    if ($('.toolbar-item.active').length) {
        $('.toolbar-item.active').removeClass('active');
    }
    $(this).addClass('active');
    $('.popover').remove();
});

$('.toolbar-item').mouseleave(function () {
    if ($(this).hasClass('active')) {
        $(this).removeClass('active');
    }
});

/* colorpallet */

$('.pallet-color').click(function () {
    updateColorPalletPreview();
});

function updateColorPalletPreview() { /* if black color -> white, rest -> black */
    $('.color-selector').css('background-color', selectedColor);
    if (selectedColor == 'rgb(0,0,0)') {
        $('.color-selector>i').css('color', '#fff');
    } else {
        $('.color-selector>i').css('color', '#000');
    }
}

/* pen size */

$('.stroke-increase').click(function () {
    if (selectedSize < 10) {
        setStrokeSize(selectedSize + 1);
        $('.current-stroke-size').html(selectedSize);
    }
});

$('.stroke-decrease').click(function () {
    if (selectedSize > 1) {
        setStrokeSize(selectedSize - 1);
        $('.current-stroke-size').html(selectedSize);
    }
});

/* connection status */

var watchConnectionStatus = true;
while (watchConnectionStatus) {
    if (isInRoom) {
        $('#connection-status').addClass('online');
    } else {
        $('#connection-status').removeClass('online');
    }
}